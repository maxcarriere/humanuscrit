{% comment %}
  Navigation : Texte précédent / suivant (ordre logique 00_, 01_), Retour au dossier parent
  Ordre basé sur le tri des chemins (00_avertissement avant 01_prefaceA)
{% endcomment %}
{% assign path = page.path %}
{% assign is_texte = false %}
{% assign is_production = false %}
{% if path contains "textes/" and path != "textes/index.md" %}
  {% assign is_texte = true %}
{% endif %}
{% if path contains "productions/" and path != "productions/index.md" %}
  {% assign is_production = true %}
{% endif %}
{% if is_texte or is_production %}
  {% assign parts = path | split: "/" %}
  {% assign dir = "" %}
  {% for part in parts %}
    {% if forloop.last %}{% break %}{% endif %}
    {% if dir != "" %}{% assign dir = dir | append: "/" %}{% endif %}
    {% assign dir = dir | append: part %}
  {% endfor %}

  {% comment %} Parent = dossier contenant dir. Pour index.md, on remonte d'un niveau. {% endcomment %}
  {% if page.name == "index.md" %}
    {% assign dir_parts = dir | split: "/" %}
    {% assign n_parent = dir_parts | size | minus: 1 %}
    {% if n_parent > 0 %}
      {% assign parent_dir = dir_parts[0] %}
      {% for i in (1..n_parent) %}
        {% if i < n_parent %}
          {% assign parent_dir = parent_dir | append: "/" | append: dir_parts[i] %}
        {% endif %}
      {% endfor %}
    {% else %}
      {% assign parent_dir = dir %}
    {% endif %}
  {% else %}
    {% assign parent_dir = dir %}
  {% endif %}

  {% comment %} Siblings : fichiers directs + index des sous-dossiers, triés par path (00_, 01_) {% endcomment %}
  {% assign prev_page = "" %}
  {% assign next_page = "" %}
  {% assign found_current = false %}
  {% assign prefix = dir | append: "/" %}
  {% assign sorted = site.pages | sort: "path" %}
  {% for p in sorted %}
    {% unless p.path contains prefix %}{% continue %}{% endunless %}
    {% assign full_idx = dir | append: "/index.md" %}
    {% if p.path == full_idx %}{% continue %}{% endif %}
    {% assign rel_path = p.path | remove_first: prefix %}
    {% assign rel_parts = rel_path | split: "/" %}
    {% assign depth = rel_parts | size %}
    {% if depth == 1 and p.name != "index.md" and p.name != "README.md" %}
      {% if p.url == page.url %}
        {% assign found_current = true %}
      {% elsif found_current %}
        {% assign next_page = p %}
        {% break %}
      {% else %}
        {% assign prev_page = p %}
      {% endif %}
    {% elsif depth == 2 and p.name == "index.md" %}
      {% if p.url == page.url %}
        {% assign found_current = true %}
      {% elsif found_current %}
        {% assign next_page = p %}
        {% break %}
      {% else %}
        {% assign prev_page = p %}
      {% endif %}
    {% endif %}
  {% endfor %}

  {% comment %} Si on est sur l'index, "suivant" = premier item du dossier {% endcomment %}
  {% if page.name == "index.md" and next_page == "" and prev_page == "" %}
    {% for p in sorted %}
      {% unless p.path contains prefix %}{% continue %}{% endunless %}
      {% assign full_idx = dir | append: "/index.md" %}
      {% if p.path == full_idx %}{% continue %}{% endif %}
      {% assign rel_path = p.path | remove_first: prefix %}
      {% assign rel_parts = rel_path | split: "/" %}
      {% assign depth = rel_parts | size %}
      {% if depth == 1 and p.name != "index.md" and p.name != "README.md" %}
        {% assign next_page = p %}
        {% break %}
      {% elsif depth == 2 and p.name == "index.md" %}
        {% assign next_page = p %}
        {% break %}
      {% endif %}
    {% endfor %}
  {% endif %}

  <nav class="navigation-dossier" aria-label="Navigation dans le dossier">
    <p>
      {% if prev_page != "" %}
        <a href="{{ prev_page.url | relative_url }}" title="Texte précédent">←</a> ·
      {% endif %}
      {% if next_page != "" %}
        <a href="{{ next_page.url | relative_url }}" title="Texte suivant">→</a> ·
      {% endif %}
      {% assign parent_url = parent_dir | prepend: "/" | append: "/" %}
      <a href="{{ parent_url | relative_url }}" title="Retour au dossier parent">↑</a>
    </p>
  </nav>
{% endif %}
